# Pre-commit hooks for ProjectScylla
# See https://pre-commit.com for more information

repos:

  # Security checks
  - repo: local
    hooks:
      - id: check-shell-injection
        name: Check for shell=True (Security)
        description: Prevent command injection vulnerabilities via shell=True
        entry: 'shell=True'
        language: pygrep
        files: \.py$
        types: [python]

  # Python formatting and linting
  - repo: local
    hooks:
      - id: ruff-format-python
        name: Ruff Format Python
        description: Format Python files in scripts/, scylla/, tests/, and all subdirectories using pixi run ruff format
        entry: pixi run ruff format scripts/ scylla/ tests/
        language: system
        files: ^(scripts|scylla|tests)/.*\.py$
        types: [python]
        pass_filenames: false
      - id: ruff-check-python
        name: Ruff Check Python
        description: Lint Python files in scripts/, scylla/, tests/, and all subdirectories using pixi run ruff check
        entry: pixi run ruff check --fix scripts/ scylla/ tests/
        language: system
        files: ^(scripts|scylla|tests)/.*\.py$
        types: [python]
        pass_filenames: false
      - id: mypy-check-python
        name: Mypy Type Check Python
        description: Type check Python files in scripts/, scylla/, tests/ using pixi run mypy. See MYPY_KNOWN_ISSUES.md for current state.
        entry: pixi run mypy scripts/ scylla/ tests/
        language: system
        files: ^(scripts|scylla|tests)/.*\.py$
        types: [python]
        pass_filenames: false
      - id: check-type-alias-shadowing
        name: Check Type Alias Shadowing
        description: Prevent type aliases that shadow more specific domain names (e.g., Result = DomainResult)
        entry: python scripts/check_type_alias_shadowing.py
        language: system
        files: ^(scripts|scylla|tests)/.*\.py$
        exclude: ^tests/test_check_type_alias_shadowing\.py$
        types: [python]
        pass_filenames: true
      - id: validate-model-configs
        name: Validate Model Config Naming
        description: Ensure model config filenames match the model_id and required fields are present
        entry: pixi run python scripts/validate_model_configs.py
        language: system
        files: ^config/models/.*\.yaml$
        pass_filenames: false
      - id: check-model-config-consistency
        name: Check Model Config Filename/model_id Consistency
        description: Fails if any config/models/*.yaml filename does not match its model_id field (uses scylla.config.validation)
        entry: pixi run python scripts/check_model_config_consistency.py
        language: system
        files: ^config/models/.*\.yaml$
        pass_filenames: false

  # Markdown linting
  - repo: https://github.com/DavidAnson/markdownlint-cli2
    rev: v0.20.0
    hooks:
      - id: markdownlint-cli2
        name: Markdown Lint
        description: Lint markdown files for consistency
        exclude: ^(notes/(plan|issues|review|blog)/|build/|docs/template\.md|docs/arxiv/|docs/design/figures/)
        args: ['--config', '.markdownlint.json', '--fix']

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.38.0
    hooks:
      - id: yamllint
        name: YAML Lint
        description: Lint YAML files for syntax and style
        args: ['--config-file', '.yamllint.yaml']
        exclude: ^(\.pixi|build)/

  # Shell script linting
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.9.0.6
    hooks:
      - id: shellcheck
        name: ShellCheck
        description: Lint shell scripts and templates for best practices
        exclude: ^(build/|docs/arxiv/)
        files: \.(sh|bash|sh\.template)$
        types: [text]
        args: ['--exclude=SC1091']
        exclude: ^docs/arxiv/

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim Trailing Whitespace
        exclude: ^notes/(plan|review|issues)/
      - id: end-of-file-fixer
        name: Fix End of Files
        exclude: ^notes/(plan|review|issues)/
      - id: check-added-large-files
        name: Check for Large Files
        args: ['--maxkb=5000']
      - id: mixed-line-ending
        name: Fix Mixed Line Endings
        exclude: ^notes/(plan|review|issues)/
