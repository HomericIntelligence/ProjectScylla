# Pre-commit hooks for ProjectScylla
# See https://pre-commit.com for more information

repos:

  # Security checks
  - repo: local
    hooks:
      - id: check-shell-injection
        name: Check for shell=True (Security)
        description: Prevent command injection vulnerabilities via shell=True
        entry: 'shell=True'
        language: pygrep
        files: \.py$
        types: [python]

  # Python formatting and linting
  - repo: local
    hooks:
      - id: ruff-format-python
        name: Ruff Format Python
        description: Format Python files in scripts/, scylla/, tests/, and all subdirectories using pixi run ruff format
        entry: pixi run ruff format scripts/ scylla/ tests/
        language: system
        files: ^(scripts|scylla|tests)/.*\.py$
        types: [python]
        pass_filenames: false
      - id: ruff-check-python
        name: Ruff Check Python
        description: Lint Python files in scripts/, scylla/, tests/, and all subdirectories using pixi run ruff check
        entry: pixi run ruff check --fix scripts/ scylla/ tests/
        language: system
        files: ^(scripts|scylla|tests)/.*\.py$
        types: [python]
        pass_filenames: false
      - id: mypy-check-python
        name: Mypy Type Check Python
        description: Type check Python files in scripts/, scylla/, tests/ using pixi run mypy
        entry: pixi run mypy scripts/ scylla/ tests/
        language: system
        files: ^(scripts|scylla|tests)/.*\.py$
        types: [python]
        pass_filenames: false

  # Markdown linting
#  - repo: https://github.com/DavidAnson/markdownlint-cli2
#    rev: v0.12.1
#    hooks:
#      - id: markdownlint-cli2
#        name: Markdown Lint
#        description: Lint markdown files for consistency
#        exclude: ^notes/(plan|issues|review|blog)/
#        args: ['--config', '.markdownlint.json']

  # Jupyter notebook output stripping
  # TODO: Re-enable after pre-commit/identify is upgraded to support 'jupyter' type tag
  # - repo: https://github.com/kynan/nbstripout
  #   rev: 0.8.1
  #   hooks:
  #     - id: nbstripout
  #       name: Strip Notebook Outputs
  #       description: Remove outputs from Jupyter notebooks before commit
  #       files: \.ipynb$
  #       args: ['--extra-keys', 'metadata.kernelspec']

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        name: Trim Trailing Whitespace
        exclude: ^notes/(plan|review|issues)/
      - id: end-of-file-fixer
        name: Fix End of Files
        exclude: ^notes/(plan|review|issues)/
#      - id: check-yaml
#      - name: Check YAML
      - id: check-added-large-files
        name: Check for Large Files
        args: ['--maxkb=5000']
      - id: mixed-line-ending
        name: Fix Mixed Line Endings
        exclude: ^notes/(plan|review|issues)/
