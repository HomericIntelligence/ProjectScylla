[workspace]
name = "scylla"
version = "0.1.0"
description = "AI agent testing and optimization framework"
channels = ["conda-forge"]
platforms = ["linux-64", "osx-arm64", "osx-64", "win-64"]

[tasks]
test = "pytest"
test-shell = "bats tests/shell/ --recursive --timing"
lint = "ruff check scylla scripts tests"
format = "ruff format scylla scripts tests"
plan-issues = "python scripts/plan_issues.py"
mypy-regression = "python scripts/check_mypy_counts.py"
audit = "pixi run --environment lint pip-audit"

[dependencies]
python = ">=3.10"
pip = "*"
pre-commit = ">=4.5.1,<5"
pytest = ">=9.0.2,<10"
pytest-cov = ">=7.0.0,<8"
types-pyyaml = ">=6.0.12.20250915,<7"
types-jsonschema = ">=4.26.0.20260202,<5"

[pypi-dependencies]
scylla = { path = ".", editable = true }
matplotlib = ">=3.8"
numpy = ">=1.24"
pandas = ">=2.0"
seaborn = ">=0.13"
scipy = ">=1.11"
altair = ">=5.0"
vl-convert-python = ">=1.0"
krippendorff = ">=0.6.0"
statsmodels = ">=0.14"
jsonschema = ">=4.0"
defusedxml = ">=0.7"

[feature.dev.dependencies]
pytest = ">=7.0"
pytest-cov = ">=4.0"
pre-commit = ">=3.0"
ruff = ">=0.1.0"
mypy = ">=1.8.0"
yamllint = ">=1.35.0"
bats-core = ">=1.11.0"

[feature.dev.pypi-dependencies]
pip-audit = ">=2.7"

[feature.lint.dependencies]
# Minimal dependencies for CI pre-commit checks only
ruff = ">=0.1.0"
mypy = ">=1.8.0"
yamllint = ">=1.35.0"
pre-commit = ">=3.0"

[feature.lint.pypi-dependencies]
pip-audit = ">=2.7"

[feature.lint.tasks]
pip-audit = "pip-audit --format json | python scripts/filter_audit.py"

[environments]
default = { features = ["dev"], solve-group = "default" }
lint = { features = ["lint"], solve-group = "lint" }
